<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aviator Pro Max - Final Fixed</title>
    
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendEmailVerification, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCrk8ksYM1Kt6ehT0TkDr3vjybjHDCyDgc",
        authDomain: "myaviatoregame.firebaseapp.com",
        projectId: "myaviatoregame",
        storageBucket: "myaviatoregame.firebasestorage.app",
        messagingSenderId: "286687400349",
        appId: "1:286687400349:web:e01e2cff439a3267de1f74"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth();
      const db = getFirestore();

      window.wallet = 0;
      window.userData = {};
      let multiplier = 1.00;
      let gameInterval;
      let isFlying = false;

      // --- AUTH & PROFILE ---
      window.handleAuth = async () => {
        const email = document.getElementById('auth-email').value;
        const pass = document.getElementById('auth-pass').value;
        try {
          if (window.isLoginMode) {
            const res = await signInWithEmailAndPassword(auth, email, pass);
            if (!res.user.emailVerified) { alert("Verify Email!"); await signOut(auth); }
          } else {
            const uid_short = "AV" + Math.floor(1000 + Math.random() * 9000);
            const res = await createUserWithEmailAndPassword(auth, email, pass);
            await sendEmailVerification(res.user);
            await setDoc(doc(db, "users", res.user.uid), { balance: 0, email, gameId: uid_short, name: "Player", avatar: "1" });
            alert("Verification sent! ID: " + uid_short);
            window.toggleAuthMode();
          }
        } catch (err) { alert(err.message); }
      };

      function startSync(uid) {
        onSnapshot(doc(db, "users", uid), (d) => {
          if(d.exists()) {
            window.userData = d.data();
            window.wallet = d.data().balance;
            document.getElementById('bal-text').innerText = window.wallet.toFixed(2);
            document.getElementById('profile-name').innerText = window.userData.name;
            document.getElementById('profile-id').innerText = "ID: " + window.userData.gameId;
            document.getElementById('user-avatar').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${window.userData.avatar}`;
          }
        });
        startGameLoop(); // Start plane engine
      }

      // --- GAME ENGINE (FIXED 1.00x ISSUE) ---
      function startGameLoop() {
        if(isFlying) return;
        isFlying = true;
        multiplier = 1.00;
        let crashPoint = (Math.random() * 5 + 1).toFixed(2); // Random crash between 1x and 5x

        gameInterval = setInterval(() => {
          multiplier += 0.01;
          document.getElementById('multiplier-text').innerText = multiplier.toFixed(2) + "x";
          document.getElementById('multiplier-text').style.color = "white";

          if(multiplier >= crashPoint) {
            clearInterval(gameInterval);
            document.getElementById('multiplier-text').style.color = "#d11348";
            document.getElementById('multiplier-text').innerText = "FLEW AWAY!";
            isFlying = false;
            setTimeout(startGameLoop, 3000); // Next round
          }
        }, 100);
      }

      // --- MENU & REFERRAL ---
      window.toggleMenu = () => {
        const m = document.getElementById('side-menu');
        m.style.left = m.style.left === '0px' ? '-280px' : '0px';
      };

      window.copyReferral = () => {
        const link = `https://yourdomain.com?ref=${window.userData.gameId}`;
        navigator.clipboard.writeText(link);
        alert("Referral Link Copied! (Earn 500)");
      };

      onAuthStateChanged(auth, (u) => { if(u && u.emailVerified) { document.getElementById('auth-screen').style.display='none'; startSync(u.uid); }});
    </script>

    <style>
        :root { --bg-dark: #0a0e17; --panel-bg: #161d2b; --win-green: #28a745; --accent-red: #d11348; }
        body { background: var(--bg-dark); color: white; font-family: sans-serif; margin: 0; overflow: hidden; }
        .top-nav { background: #0f1521; padding: 10px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #252f44; }
        #side-menu { position: fixed; top: 0; left: -280px; width: 260px; height: 100%; background: #161d2b; z-index: 9999; transition: 0.3s; padding: 20px; border-right: 2px solid #ff0055; }
        .menu-item { padding: 15px 0; border-bottom: 1px solid #252f44; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .avatar-img { width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--win-green); }
        .display-area { height: 220px; background: radial-gradient(circle at bottom left, #1a2a44, #05080f); margin: 10px; border-radius: 15px; display: flex; align-items: center; justify-content: center; }
        .bet-card { background: var(--panel-bg); padding: 10px; border-radius: 12px; width: 50%; border: 1px solid #252f44; }
        .q-btn { background: #000; border: 1px solid #333; color: #fff; font-size: 10px; padding: 5px; border-radius: 5px; margin: 2px; }
        .main-btn { width: 100%; padding: 12px; border: none; border-radius: 10px; background: var(--win-green); color: white; font-weight: bold; cursor: pointer; }
        #auth-screen { position: fixed; inset: 0; background: var(--bg-dark); z-index: 10000; display: flex; justify-content: center; align-items: center; }
    </style>
</head>
<body>

<div id="side-menu">
    <div style="text-align: center; margin-bottom: 20px;">
        <img id="user-avatar" src="" class="avatar-img">
        <div id="profile-name" style="font-weight: bold; margin-top: 5px;">Player</div>
        <div id="profile-id" style="font-size: 10px; color: #9ea0a3;">ID: 0000</div>
    </div>
    <div class="menu-item" onclick="document.getElementById('dep-modal').style.display='flex'; toggleMenu()">üí∞ Deposit</div>
    <div class="menu-item" onclick="toggleMenu()">üè¶ Withdrawal</div>
    <div class="menu-item" onclick="copyReferral()">üîó Referral (Earn 500)</div>
    <div class="menu-item" style="color: red;" onclick="location.reload()">üö™ Logout</div>
</div>

<div id="auth-screen">
    <div style="background: #161d2b; padding: 30px; border-radius: 15px; text-align: center; width: 80%;">
        <h2 id="auth-title" style="color:#ff0055">LOGIN</h2>
        <input type="email" id="auth-email" style="width:90%; padding:10px; margin-bottom:10px;" placeholder="Email">
        <input type="password" id="auth-pass" style="width:90%; padding:10px; margin-bottom:10px;" placeholder="Password">
        <button class="main-btn" onclick="handleAuth()">PROCEED</button>
        <p onclick="window.isLoginMode=!window.isLoginMode; document.getElementById('auth-title').innerText=window.isLoginMode?'LOGIN':'REGISTER'" style="cursor:pointer; font-size:12px; margin-top:10px;">Switch Register/Login</p>
    </div>
</div>

<div class="top-nav">
    <div onclick="toggleMenu()" style="font-size: 24px; cursor: pointer;">‚ò∞</div>
    <div style="color:#ff0055; font-weight:900; font-size:20px;">AVIATOR</div>
    <div style="display: flex; align-items: center; gap: 5px;">
        <span style="color: #28a745; font-weight: bold;">‚Çπ<span id="bal-text">0.00</span></span>
        <button style="background: #28a745; border:none; color:white; border-radius:50%; width:20px; height:20px;" onclick="document.getElementById('dep-modal').style.display='flex'">+</button>
    </div>
</div>

<div class="display-area">
    <h1 id="multiplier-text" style="font-size: 3.5rem;">1.00x</h1>
</div>

<div style="display: flex; gap: 10px; padding: 10px;">
    <div class="bet-card">
        <div style="font-size: 10px; color: gray; margin-bottom: 5px;">Auto Play <input type="checkbox"> Auto Cash <input type="checkbox"></div>
        <input type="number" id="amt-1" value="100" style="width: 80%; background: #000; color: white; border: none; padding: 5px;">
        <div>
            <button class="q-btn" onclick="document.getElementById('amt-1').value=10">10</button>
            <button class="q-btn" onclick="document.getElementById('amt-1').value=100">100</button>
            <button class="q-btn" onclick="document.getElementById('amt-1').value=500">500</button>
            <button class="q-btn" onclick="document.getElementById('amt-1').value=1000">1000</button>
        </div>
        <button class="main-btn" style="margin-top: 8px;">BET</button>
    </div>
    <div class="bet-card">
        <div style="font-size: 10px; color: gray; margin-bottom: 5px;">Auto Play <input type="checkbox"> Auto Cash <input type="checkbox"></div>
        <input type="number" id="amt-2" value="100" style="width: 80%; background: #000; color: white; border: none; padding: 5px;">
        <div>
            <button class="q-btn" onclick="document.getElementById('amt-2').value=10">10</button>
            <button class="q-btn" onclick="document.getElementById('amt-2').value=100">100</button>
            <button class="q-btn" onclick="document.getElementById('amt-2').value=500">500</button>
            <button class="q-btn" onclick="document.getElementById('amt-2').value=1000">1000</button>
        </div>
        <button class="main-btn" style="margin-top: 8px; background: #1267ff;">BET</button>
    </div>
</div>

<div id="dep-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:10001; justify-content:center; align-items:center;">
    <div style="background: #161d2b; padding: 25px; border-radius: 15px; width: 80%; text-align: center;">
        <h3>Deposit</h3>
        <input type="number" id="d-amt" style="width: 90%; padding: 10px; margin: 10px 0;" placeholder="Amount">
        <input type="text" id="d-utr" style="width: 90%; padding: 10px; margin: 10px 0;" placeholder="12 Digit UTR">
        <button class="main-btn" onclick="alert('Sent!')">Submit</button>
        <button onclick="document.getElementById('dep-modal').style.display='none'" style="margin-top:10px; background:none; border:none; color:gray;">Close</button>
    </div>
</div>

</body>
</html>
