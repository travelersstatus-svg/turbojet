<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aviator Pro Max - Official</title>
    
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendEmailVerification, onAuthStateChanged, signOut, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCrk8ksYM1Kt6ehT0TkDr3vjybjHDCyDgc",
        authDomain: "myaviatoregame.firebaseapp.com",
        projectId: "myaviatoregame",
        storageBucket: "myaviatoregame.firebasestorage.app",
        messagingSenderId: "286687400349",
        appId: "1:286687400349:web:e01e2cff439a3267de1f74"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth();
      const db = getFirestore();

      // Ensure user stays logged in
      setPersistence(auth, browserLocalPersistence);

      window.isLoginMode = true;
      let multiplier = 1.00;
      let isFlying = false;
      let resultsHistory = [];

      // --- AUTH FUNCTIONS ---
      window.toggleAuth = () => {
          window.isLoginMode = !window.isLoginMode;
          document.getElementById('auth-title').innerText = window.isLoginMode ? "LOGIN" : "REGISTER";
          document.getElementById('resend-box').style.display = window.isLoginMode ? "none" : "block";
      };

      window.handleAuth = async () => {
          const email = document.getElementById('auth-email').value;
          const pass = document.getElementById('auth-pass').value;
          try {
              if (window.isLoginMode) {
                  const res = await signInWithEmailAndPassword(auth, email, pass);
                  if (!res.user.emailVerified) {
                      alert("Please verify your email first!");
                      await signOut(auth);
                  }
              } else {
                  const res = await createUserWithEmailAndPassword(auth, email, pass);
                  await sendEmailVerification(res.user);
                  await setDoc(doc(db, "users", res.user.uid), { 
                      balance: 0, 
                      email, 
                      gameId: "AV" + Math.floor(1000 + Math.random() * 9000),
                      referralPoints: 0
                  });
                  alert("Registration Successful! Verification link sent to your email.");
                  window.toggleAuth();
              }
          } catch (e) { alert(e.message); }
      };

      window.resendLink = async () => {
          if (auth.currentUser) {
              await sendEmailVerification(auth.currentUser);
              alert("Verification link resent!");
          } else { alert("Please enter details and try registering again."); }
      };

      window.logout = () => { signOut(auth).then(() => location.reload()); };

      // --- GAME ENGINE ---
      function startEngine() {
          if(isFlying) return;
          isFlying = true;
          multiplier = 1.00;
          let crashAt = (Math.random() * 5 + 1.1).toFixed(2);
          let timer = setInterval(() => {
              multiplier += 0.01;
              document.getElementById('multiplier-text').innerText = multiplier.toFixed(2) + "x";
              if (multiplier >= crashAt) {
                  clearInterval(timer);
                  document.getElementById('multiplier-text').innerText = "FLEW AWAY!";
                  resultsHistory.unshift(multiplier.toFixed(2));
                  if(resultsHistory.length > 30) resultsHistory.pop();
                  updateHistoryUI();
                  isFlying = false;
                  setTimeout(startEngine, 4000);
              }
          }, 80);
      }

      function updateHistoryUI() {
          document.getElementById('hist-list').innerHTML = resultsHistory.map(r => `<span>${r}x</span>`).join('');
      }

      onAuthStateChanged(auth, (user) => {
          if (user && user.emailVerified) {
              document.getElementById('auth-page').style.display = 'none';
              onSnapshot(doc(db, "users", user.uid), (d) => {
                  if(d.exists()) document.getElementById('bal-text').innerText = d.data().balance.toFixed(2);
              });
              startEngine();
          } else {
              document.getElementById('auth-page').style.display = 'flex';
          }
      });
    </script>

    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: #0a0e17; color: white; font-family: sans-serif; }
        
        /* Auth Page Styling */
        #auth-page { position: fixed; inset: 0; background: #0a0e17; z-index: 5000; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: #161d2b; padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; border: 1px solid #252f44; }
        .auth-input { width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 8px; }
        
        /* Header */
        .header { background: #0f1521; padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; }
        .wallet-box { background: #000; border: 1px solid #28a745; padding: 5px 12px; border-radius: 20px; color: #28a745; font-weight: bold; }
        
        /* Sidebar (Right Side) */
        #sidebar { position: fixed; top: 0; right: -280px; width: 260px; height: 100%; background: #161d2b; z-index: 1000; transition: 0.3s; padding: 25px; border-left: 2px solid #ff0055; }
        .menu-link { padding: 15px 0; border-bottom: 1px solid #252f44; cursor: pointer; display: block; text-decoration: none; color: white; }

        /* Game UI */
        .display { height: 220px; background: radial-gradient(circle at bottom, #1a2a44, #05080f); margin: 15px; border-radius: 15px; display: flex; align-items: center; justify-content: center; }
        #multiplier-text { font-size: 3.5rem; font-weight: 900; }

        /* History Dropdown */
        .hist-header { background: #111827; padding: 10px 15px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; border-bottom: 1px solid #222; }
        #hist-list { display: none; background: #0f1521; padding: 10px; grid-template-columns: repeat(5, 1fr); gap: 5px; }
        #hist-list span { background: #1a2233; padding: 3px; border-radius: 8px; font-size: 10px; text-align: center; color: #9d50ff; }

        .bet-card { background: #161d2b; padding: 15px; border-radius: 15px; flex: 1; border: 1px solid #252f44; }
        .btn-green { background: #28a745; width: 100%; padding: 10px; border: none; border-radius: 8px; color: white; font-weight: bold; margin-top: 10px; cursor: pointer; }
    </style>
</head>
<body>

<div id="auth-page">
    <div class="auth-card">
        <h2 id="auth-title" style="color:#ff0055; margin-bottom:15px;">LOGIN</h2>
        <input type="email" id="auth-email" class="auth-input" placeholder="Email Address">
        <input type="password" id="auth-pass" class="auth-input" placeholder="Password">
        <button class="btn-green" onclick="handleAuth()">PROCEED</button>
        <p id="resend-box" style="display:none; font-size:12px; margin-top:10px; color:#aaa;" onclick="resendLink()">Didn't get link? <u>Resend Verification</u></p>
        <p style="margin-top:15px; font-size:13px; cursor:pointer;" onclick="toggleAuth()">Don't have an account? <u>Register</u></p>
    </div>
</div>

<div id="sidebar">
    <h3 style="color:#ff0055">MENU</h3>
    <div class="menu-link" onclick="alert('Deposit Panel')">üí∞ Deposit</div>
    <div class="menu-link" onclick="alert('Withdraw Panel')">üè¶ Withdraw</div>
    <div class="menu-link">üìú Transaction History</div>
    <div class="menu-link">üîó Referral Link</div>
    <div class="menu-link" style="color:#ff4444; margin-top:30px;" onclick="logout()">üö™ Logout</div>
    <button style="margin-top:20px; background:none; border:none; color:gray;" onclick="document.getElementById('sidebar').style.right='-280px'">Close</button>
</div>

<div class="header">
    <div style="color:#ff0055; font-weight:900; font-size:22px;">AVIATOR</div>
    <div style="display:flex; align-items:center; gap:12px;">
        <div class="wallet-box">‚Çπ<span id="bal-text">0.00</span></div>
        <div onclick="document.getElementById('sidebar').style.right='0px'" style="font-size:26px; cursor:pointer;">‚ò∞</div>
    </div>
</div>

<div class="hist-header" onclick="const l=document.getElementById('hist-list'); l.style.display=l.style.display==='grid'?'none':'grid'">
    Past Results (Last 30) <span>‚ñº</span>
</div>
<div id="hist-list"></div>

<div class="display">
    <h1 id="multiplier-text">1.00x</h1>
</div>

<div style="display:flex; gap:10px; padding:15px;">
    <div class="bet-card">
        <div style="font-size:10px; color:gray">Auto Play <input type="checkbox"> Auto Cash <input type="checkbox"></div>
        <input type="number" id="amt-1" value="100" style="width:100%; background:#000; border:none; color:#fff; padding:5px; margin-top:5px;">
        <button class="btn-green">BET</button>
    </div>
    <div class="bet-card">
        <div style="font-size:10px; color:gray">Auto Play <input type="checkbox"> Auto Cash <input type="checkbox"></div>
        <input type="number" id="amt-2" value="100" style="width:100%; background:#000; border:none; color:#fff; padding:5px; margin-top:5px;">
        <button class="btn-green" style="background:#1267ff">BET</button>
    </div>
</div>

<div style="margin:15px; background:#161d2b; padding:10px; border-radius:10px;">
    <table style="width:100%; font-size:12px; text-align:left;">
        <thead style="color:gray;"><tr><th>User</th><th>Bet</th><th>Cash Out</th></tr></thead>
        <tbody id="fake-table-body"></tbody>
    </table>
</div>

<script>
    const users = ["Amit", "Sumit", "Pooja", "Rahul", "Vikash", "Soni"];
    setInterval(() => {
        const body = document.getElementById('fake-table-body');
        const row = `<tr style="border-bottom:1px solid #222;"><td style="padding:8px;">${users[Math.floor(Math.random()*6)]}***</td><td>‚Çπ${(Math.random()*500+10).toFixed(0)}</td><td style="color:#28a745">${(Math.random()*2+1.1).toFixed(2)}x</td></tr>`;
        body.insertAdjacentHTML('afterbegin', row);
        if(body.children.length > 6) body.lastElementChild.remove();
    }, 2500);
</script>

</body>
</html>
