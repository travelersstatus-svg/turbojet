<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aviator Pro Max - Official</title>
    
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendEmailVerification, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCrk8ksYM1Kt6ehT0TkDr3vjybjHDCyDgc",
        authDomain: "myaviatoregame.firebaseapp.com",
        projectId: "myaviatoregame",
        storageBucket: "myaviatoregame.firebasestorage.app",
        messagingSenderId: "286687400349",
        appId: "1:286687400349:web:e01e2cff439a3267de1f74"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth();
      const db = getFirestore();

      window.wallet = 0;
      let multiplier = 1.00;
      let resultsHistory = [];
      let isFlying = false;

      // --- SYNC & AUTH ---
      function startSync(uid) {
        onSnapshot(doc(db, "users", uid), (d) => {
          if(d.exists()) {
            window.wallet = d.data().balance;
            document.getElementById('bal-text').innerText = window.wallet.toFixed(2);
          }
        });
        if(!isFlying) startGameLoop();
      }

      function startGameLoop() {
        isFlying = true;
        multiplier = 1.00;
        let crashPoint = (Math.random() * 4 + 1.1).toFixed(2);
        let gameInt = setInterval(() => {
          multiplier += 0.01;
          document.getElementById('multiplier-text').innerText = multiplier.toFixed(2) + "x";
          if(multiplier >= crashPoint) {
            clearInterval(gameInt);
            document.getElementById('multiplier-text').innerText = "FLEW AWAY!";
            resultsHistory.unshift(multiplier.toFixed(2));
            if(resultsHistory.length > 30) resultsHistory.pop();
            updateHistoryUI();
            isFlying = false;
            setTimeout(startGameLoop, 4000);
          }
        }, 70);
      }

      function updateHistoryUI() {
          const list = document.getElementById('hist-dropdown');
          list.innerHTML = resultsHistory.map(r => `<span>${r}x</span>`).join('');
      }

      window.handleAuth = async () => {
        const email = document.getElementById('auth-email').value;
        const pass = document.getElementById('auth-pass').value;
        try {
          if (window.isLoginMode) {
             const res = await signInWithEmailAndPassword(auth, email, pass);
             if (!res.user.emailVerified) { alert("Verify Email!"); await signOut(auth); }
          } else {
             const res = await createUserWithEmailAndPassword(auth, email, pass);
             await sendEmailVerification(res.user);
             await setDoc(doc(db, "users", res.user.uid), { balance: 0, email, gameId: "AV"+Math.floor(1000+Math.random()*9000), name: "Player", avatar: "1" });
             alert("Verify link sent!");
          }
        } catch (e) { alert(e.message); }
      };

      onAuthStateChanged(auth, (u) => { if(u && u.emailVerified) { document.getElementById('auth-screen').style.display='none'; startSync(u.uid); }});
    </script>

    <style>
        :root { --bg-dark: #0a0e17; --panel-bg: #161d2b; --win-green: #28a745; }
        body { background: var(--bg-dark); color: white; font-family: sans-serif; margin: 0; padding: 0; overflow-x: hidden; }
        
        /* Layout Fix: Removed Left Red Line */
        .top-nav { background: #0f1521; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #252f44; }
        .nav-right { display: flex; align-items: center; gap: 10px; }
        
        .balance-container { background: #000; border: 1px solid var(--win-green); padding: 4px 12px; border-radius: 20px; color: var(--win-green); font-weight: bold; display: flex; align-items: center; gap: 5px; }
        
        /* Dropdown Results */
        .history-bar { background: #111827; padding: 5px 15px; font-size: 12px; display: flex; justify-content: space-between; cursor: pointer; border-bottom: 1px solid #222; }
        #hist-dropdown { display: none; background: #0f1521; padding: 10px; grid-template-columns: repeat(5, 1fr); gap: 5px; text-align: center; }
        #hist-dropdown span { background: #161d2b; padding: 2px; border-radius: 10px; color: #9d50ff; border: 1px solid #252f44; font-size: 10px; }

        /* Game Area */
        .display-area { height: 210px; background: radial-gradient(circle at bottom, #1a2a44, #05080f); margin: 10px; border-radius: 15px; display: flex; align-items: center; justify-content: center; position: relative; }
        #multiplier-text { font-size: 3.5rem; font-weight: 900; }

        /* Fake User Table */
        .live-bets { margin: 10px; background: var(--panel-bg); border-radius: 10px; font-size: 11px; padding: 10px; }
        .bet-table { width: 100%; border-collapse: collapse; }
        .bet-table th { color: #9ea0a3; text-align: left; padding-bottom: 8px; font-weight: normal; }
        .bet-row { border-bottom: 1px solid #1a2233; color: #fff; }
        .bet-row td { padding: 6px 0; }

        /* Bet Cards */
        .bet-container { display: flex; gap: 8px; padding: 10px; }
        .bet-card { background: var(--panel-bg); padding: 10px; border-radius: 12px; width: 50%; border: 1px solid #252f44; }
        .main-btn { width: 100%; padding: 10px; border: none; border-radius: 8px; background: var(--win-green); color: white; font-weight: bold; cursor: pointer; }
        .q-btn { background: #000; border: 1px solid #333; color: #fff; font-size: 10px; padding: 5px; border-radius: 5px; margin: 2px; cursor: pointer; }
        
        #auth-screen { position: fixed; inset: 0; background: var(--bg-dark); z-index: 10000; display: flex; justify-content: center; align-items: center; }
        #side-menu { position: fixed; top: 0; right: -280px; width: 250px; height: 100%; background: #161d2b; z-index: 9999; transition: 0.3s; padding: 20px; border-left: 2px solid #ff0055; }
    </style>
</head>
<body>

<div id="side-menu">
    <h3 style="color: #ff0055;">HOME MENU</h3>
    <div style="margin-top:20px; cursor:pointer;" onclick="location.reload()">ðŸšª Logout</div>
    <div style="margin-top:20px;">ðŸ“œ Bet History</div>
    <div style="margin-top:20px;">ðŸ”— Referral Link</div>
</div>

<div id="auth-screen">
    <div style="background: #161d2b; padding: 30px; border-radius: 15px; text-align: center; width: 80%;">
        <h2 id="auth-title">LOGIN</h2>
        <input type="email" id="auth-email" style="width:90%; padding:10px; margin-bottom:10px;" placeholder="Email">
        <input type="password" id="auth-pass" style="width:90%; padding:10px; margin-bottom:10px;" placeholder="Password">
        <button class="main-btn" onclick="handleAuth()">PROCEED</button>
        <p onclick="window.isLoginMode=!window.isLoginMode; document.getElementById('auth-title').innerText=window.isLoginMode?'LOGIN':'REGISTER'" style="cursor:pointer; font-size:12px; margin-top:10px;">Switch Register/Login</p>
    </div>
</div>

<div class="top-nav">
    <div style="color:#ff0055; font-weight:900; font-size:18px;">AVIATOR</div>
    <div class="nav-right">
        <div class="balance-container">
            â‚¹<span id="bal-text">0.00</span>
            <div style="background:var(--win-green); color:#fff; border-radius:50%; width:18px; height:18px; text-align:center; line-height:18px; cursor:pointer;">+</div>
        </div>
        <div onclick="const m=document.getElementById('side-menu'); m.style.right=m.style.right==='0px'?'-280px':'0px'" style="font-size: 22px; cursor: pointer;">â˜°</div>
    </div>
</div>

<div class="history-bar" onclick="const d=document.getElementById('hist-dropdown'); d.style.display=d.style.display==='grid'?'none':'grid'">
    <span>Recent Results</span>
    <span>â–¼</span>
</div>
<div id="hist-dropdown"></div>

<div class="display-area">
    <h1 id="multiplier-text">1.00x</h1>
</div>

<div class="bet-container">
    <div class="bet-card">
        <div style="font-size:9px; color:gray; margin-bottom:4px;">Auto Play <input type="checkbox"> Auto Cash <input type="checkbox"></div>
        <input type="number" id="amt-1" value="100" style="width: 80%; background:#000; color:#fff; border:none; padding:4px;">
        <div>
            <button class="q-btn" onclick="document.getElementById('amt-1').value=10">10</button>
            <button class="q-btn" onclick="document.getElementById('amt-1').value=100">100</button>
            <button class="q-btn" onclick="document.getElementById('amt-1').value=500">500</button>
            <button class="q-btn" onclick="document.getElementById('amt-1').value=1000">1000</button>
        </div>
        <button class="main-btn" style="margin-top:5px;">BET</button>
    </div>
    <div class="bet-card">
        <div style="font-size:9px; color:gray; margin-bottom:4px;">Auto Play <input type="checkbox"> Auto Cash <input type="checkbox"></div>
        <input type="number" id="amt-2" value="100" style="width: 80%; background:#000; color:#fff; border:none; padding:4px;">
        <div>
            <button class="q-btn" onclick="document.getElementById('amt-2').value=10">10</button>
            <button class="q-btn" onclick="document.getElementById('amt-2').value=100">100</button>
            <button class="q-btn" onclick="document.getElementById('amt-2').value=500">500</button>
            <button class="q-btn" onclick="document.getElementById('amt-2').value=1000">1000</button>
        </div>
        <button class="main-btn" style="margin-top:5px; background:#1267ff;">BET</button>
    </div>
</div>

<div class="live-bets">
    <table class="bet-table">
        <thead>
            <tr><th>User</th><th>Bet</th><th>Cash Out</th></tr>
        </thead>
        <tbody id="fake-bet-list"></tbody>
    </table>
</div>

<script>
    const fNames = ["Rahul", "Sonia", "Vijay", "Ankit", "Priya", "Arjun", "Karan"];
    function addFakeBet() {
        const list = document.getElementById('fake-bet-list');
        const name = fNames[Math.floor(Math.random() * fNames.length)] + "****";
        const amt = (Math.random() * 500 + 10).toFixed(0);
        const cashout = (Math.random() * 2 + 1.1).toFixed(2);
        const row = `<tr class="bet-row"><td>${name}</td><td>â‚¹${amt}</td><td style="color:#28a745">${cashout}x</td></tr>`;
        list.insertAdjacentHTML('afterbegin', row);
        if(list.children.length > 8) list.lastElementChild.remove();
    }
    setInterval(addFakeBet, 2500);
</script>

</body>
</html>
