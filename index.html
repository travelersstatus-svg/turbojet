<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aviator Pro Max</title>
    
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendEmailVerification, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCrk8ksYM1Kt6ehT0TkDr3vjybjHDCyDgc",
        authDomain: "myaviatoregame.firebaseapp.com",
        projectId: "myaviatoregame",
        storageBucket: "myaviatoregame.firebasestorage.app",
        messagingSenderId: "286687400349",
        appId: "1:286687400349:web:e01e2cff439a3267de1f74"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth();
      const db = getFirestore();

      window.isLoginMode = true;
      window.userData = {};

      // --- AUTH & USER REGISTRATION ---
      window.handleAuth = async () => {
        const email = document.getElementById('auth-email').value;
        const pass = document.getElementById('auth-pass').value;
        try {
          if (window.isLoginMode) {
            const res = await signInWithEmailAndPassword(auth, email, pass);
            if (!res.user.emailVerified) { alert("Verify Email!"); await signOut(auth); }
          } else {
            const uid_short = "AV" + Math.floor(1000 + Math.random() * 9000); // Unique ID
            const res = await createUserWithEmailAndPassword(auth, email, pass);
            await sendEmailVerification(res.user);
            await setDoc(doc(db, "users", res.user.uid), { 
                balance: 0, 
                email: email, 
                gameId: uid_short, 
                name: "Player", 
                avatar: "1",
                referralCount: 0 
            });
            alert("Verify link sent! Your ID is: " + uid_short);
            window.toggleAuthMode();
          }
        } catch (err) { alert(err.message); }
      };

      function startSync(uid) {
        onSnapshot(doc(db, "users", uid), (d) => {
          if(d.exists()) { 
            window.userData = d.data();
            window.wallet = d.data().balance;
            document.getElementById('bal-text').innerText = window.wallet.toFixed(2);
            document.getElementById('profile-name').innerText = window.userData.name;
            document.getElementById('profile-id').innerText = "ID: " + window.userData.gameId;
            document.getElementById('user-avatar').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${window.userData.avatar}`;
          }
        });
      }

      onAuthStateChanged(auth, (u) => { 
          if(u && u.emailVerified) { 
              document.getElementById('auth-screen').style.display='none'; 
              startSync(u.uid); 
          }
      });

      // --- MENU LOGIC ---
      window.toggleMenu = () => {
          const m = document.getElementById('side-menu');
          m.style.left = m.style.left === '0px' ? '-280px' : '0px';
      };

      window.updateProfile = async () => {
          const newName = prompt("Enter Name:", window.userData.name);
          const newAv = Math.floor(Math.random() * 100); // Randomize Avatar
          if(newName) {
              await updateDoc(doc(db, "users", auth.currentUser.uid), { name: newName, avatar: newAv.toString() });
          }
      };
      
      window.copyReferral = () => {
          const refLink = `https://yourdomain.com?ref=${window.userData.gameId}`;
          navigator.clipboard.writeText(refLink);
          alert("Referral Link Copied! (500 pts per join)");
      };
    </script>

    <style>
        :root { --bg-dark: #0a0e17; --panel-bg: #161d2b; --win-green: #28a745; --accent-red: #d11348; --btn-blue: #1267ff; }
        body { background: var(--bg-dark); color: white; font-family: sans-serif; margin: 0; overflow: hidden; }
        
        /* AUTH RESTORED */
        #auth-screen { position: fixed; inset: 0; background: var(--bg-dark); z-index: 10000; display: flex; justify-content: center; align-items: center; }
        
        /* TOP NAV WITH MENU */
        .top-nav { background: #0f1521; padding: 10px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #252f44; }
        .menu-btn { font-size: 24px; cursor: pointer; color: #9ea0a3; }
        
        /* SIDE MENU */
        #side-menu { position: fixed; top: 0; left: -280px; width: 260px; height: 100%; background: #161d2b; z-index: 9999; transition: 0.3s; padding: 20px; border-right: 2px solid #ff0055; }
        .menu-item { padding: 15px 0; border-bottom: 1px solid #252f44; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        
        /* PROFILE BOX */
        .profile-section { text-align: center; margin-bottom: 20px; }
        .avatar-img { width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--win-green); cursor: pointer; }

        /* BET BUTTONS RESTORED */
        .bet-card { background: var(--panel-bg); padding: 10px; border-radius: 12px; width: 50%; border: 1px solid #252f44; }
        .quick-bet-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 8px; }
        .q-btn { background: #000; border: 1px solid #333; color: #fff; font-size: 10px; padding: 4px; border-radius: 5px; }
        
        /* AUTO OPTIONS */
        .auto-row { display: flex; justify-content: space-between; margin-top: 10px; font-size: 11px; color: #9ea0a3; }

        .main-btn { width: 100%; padding: 12px; border: none; border-radius: 10px; background: var(--win-green); color: white; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="side-menu">
    <div class="profile-section">
        <img id="user-avatar" src="" class="avatar-img" onclick="updateProfile()">
        <div id="profile-name" style="font-weight: bold; margin-top: 5px;">Player</div>
        <div id="profile-id" style="font-size: 10px; color: #9ea0a3;">ID: 0000</div>
    </div>
    <div class="menu-item" onclick="document.getElementById('dep-modal').style.display='flex'; toggleMenu()">üí∞ Deposit</div>
    <div class="menu-item" onclick="alert('Withdraw logic here'); toggleMenu()">üè¶ Withdrawal</div>
    <div class="menu-item" onclick="toggleMenu()">üìú History</div>
    <div class="menu-item" onclick="copyReferral()">üîó Referral (Earn 500)</div>
    <div class="menu-item" style="color: red;" onclick="location.reload()">üö™ Logout</div>
</div>

<div id="auth-screen">
    <div class="auth-card" style="background: #161d2b; padding: 30px; border-radius: 15px; text-align: center;">
        <h2 id="auth-title" style="color:#ff0055">LOGIN</h2>
        <input type="email" id="auth-email" style="width:90%; padding:10px; margin:5px;" placeholder="Email">
        <input type="password" id="auth-pass" style="width:90%; padding:10px; margin:5px;" placeholder="Password">
        <button class="main-btn" onclick="handleAuth()">PROCEED</button>
        <p onclick="window.toggleAuthMode()" style="cursor:pointer; font-size:12px; margin-top:10px;">Switch Register/Login</p>
    </div>
</div>

<div class="top-nav">
    <div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>
    <div style="color:#ff0055; font-weight:900; font-size:20px;">AVIATOR</div>
    <div style="display: flex; align-items: center; gap: 5px;">
        <span style="color: #28a745; font-weight: bold;">‚Çπ<span id="bal-text">0.00</span></span>
        <button style="background: #28a745; border:none; color:white; border-radius:50%; width:20px; height:20px;" onclick="document.getElementById('dep-modal').style.display='flex'">+</button>
    </div>
</div>

<div style="height: 220px; background: radial-gradient(circle at bottom, #1a2a44, #05080f); margin: 10px; border-radius: 15px; display: flex; align-items: center; justify-content: center;">
    <h1 id="multiplier-text" style="font-size: 3.5rem;">1.00x</h1>
</div>

<div style="display: flex; gap: 10px; padding: 10px;">
    <div class="bet-card">
        <div class="auto-row">
            <span>Auto Play <input type="checkbox"></span>
            <span>Auto Cashout <input type="checkbox"></span>
        </div>
        <input type="number" id="amt-1" value="100" style="width: 80%; background: #000; color: white; border: none; padding: 5px; margin: 5px 0;">
        <div class="quick-bet-row">
            <button class="q-btn" onclick="document.getElementById('amt-1').value=10">10</button>
            <button class="q-btn" onclick="document.getElementById('amt-1').value=100">100</button>
            <button class="q-btn" onclick="document.getElementById('amt-1').value=500">500</button>
            <button class="q-btn" onclick="document.getElementById('amt-1').value=1000">1000</button>
        </div>
        <button class="main-btn" style="margin-top: 10px;">BET</button>
    </div>

    <div class="bet-card">
        <div class="auto-row">
            <span>Auto Play <input type="checkbox"></span>
            <span>Auto Cashout <input type="checkbox"></span>
        </div>
        <input type="number" id="amt-2" value="100" style="width: 80%; background: #000; color: white; border: none; padding: 5px; margin: 5px 0;">
        <div class="quick-bet-row">
            <button class="q-btn" onclick="document.getElementById('amt-2').value=10">10</button>
            <button class="q-btn" onclick="document.getElementById('amt-2').value=100">100</button>
            <button class="q-btn" onclick="document.getElementById('amt-2').value=500">500</button>
            <button class="q-btn" onclick="document.getElementById('amt-2').value=1000">1000</button>
        </div>
        <button class="main-btn" style="margin-top: 10px; background: #1267ff;">BET</button>
    </div>
</div>

<div id="dep-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:10001; justify-content:center; align-items:center;">
    <div class="auth-card" style="background: #161d2b; padding: 25px; border-radius: 15px; width: 80%;">
        <h3>Deposit Money</h3>
        <input type="number" id="d-amt" style="width: 90%; padding: 10px; margin: 10px 0;" placeholder="Amount">
        <input type="text" id="d-utr" style="width: 90%; padding: 10px; margin: 10px 0;" placeholder="12 Digit UTR">
        <button class="main-btn" onclick="submitDeposit()">Submit Request</button>
        <button onclick="document.getElementById('dep-modal').style.display='none'" style="margin-top: 10px; background: none; color: gray; border: none;">Close</button>
    </div>
</div>

<script>
    window.toggleAuthMode = () => {
        window.isLoginMode = !window.isLoginMode;
        document.getElementById('auth-title').innerText = window.isLoginMode ? "LOGIN" : "REGISTER";
    };
</script>

</body>
</html>
