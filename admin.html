<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Aviator Pro</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        body { background: #0a0e17; color: white; font-family: sans-serif; padding: 20px; }
        .card { background: #161d2b; padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #252f44; }
        h2 { color: #ff0055; margin-bottom: 20px; border-bottom: 1px solid #252f44; padding-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #252f44; }
        .btn { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; font-size: 12px; }
        .btn-approve { background: #28a745; margin-right: 5px; }
        .btn-reject { background: #d11348; }
        .btn-edit { background: #6366f1; }
        .status-badge { padding: 2px 8px; border-radius: 4px; font-size: 10px; text-transform: uppercase; }
        .pending { background: #f59e0b; }
        .approved { background: #10b981; }
    </style>
</head>
<body>

    <h1>ADMIN PANEL</h1>

    <div class="card">
        <h2>üë• ALL USERS</h2>
        <table>
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Balance</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="user-list"></tbody>
        </table>
    </div>

    <div class="card">
        <h2>üí∞ DEPOSIT REQUESTS (NEW)</h2>
        <table>
            <thead>
                <tr>
                    <th>User</th>
                    <th>UTR & Amount</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="deposit-list"></tbody>
        </table>
    </div>

    <div class="card">
        <h2>üè¶ WITHDRAWAL REQUESTS</h2>
        <table>
            <thead>
                <tr>
                    <th>User</th>
                    <th>Amount</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="withdrawal-list"></tbody>
        </table>
    </div>

<script>
    // Apni Firebase Config yahan check karein
    const firebaseConfig = { 
        apiKey: "AIzaSyCrk8ksYM1Kt6ehT0TkDr3vjybjHDCyDgc", 
        databaseURL: "https://myaviatoregame-default-rtdb.firebaseio.com" 
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 1. Load All Users & Edit Balance Logic
    db.ref('users').on('value', snap => {
        const list = document.getElementById('user-list');
        list.innerHTML = "";
        snap.forEach(userSnap => {
            const user = userSnap.val();
            const uid = userSnap.key;
            list.innerHTML += `
                <tr>
                    <td>${user.email || 'N/A'}</td>
                    <td>‚Çπ${(user.balance || 0).toFixed(2)}</td>
                    <td><button class="btn btn-edit" onclick="editBalance('${uid}', ${user.balance})">Edit</button></td>
                </tr>
            `;
        });
    });

    window.editBalance = (uid, oldBal) => {
        const newBal = prompt("Enter New Balance for this user:", oldBal);
        if (newBal !== null) {
            db.ref('users/' + uid).update({ balance: parseFloat(newBal) })
              .then(() => alert("Balance Updated!"));
        }
    };

    // 2. Load Deposit Requests
    db.ref('requests/deposits').on('value', snap => {
        const list = document.getElementById('deposit-list');
        list.innerHTML = "";
        snap.forEach(reqSnap => {
            const req = reqSnap.val();
            if(req.status === "pending") {
                list.innerHTML += `
                    <tr>
                        <td>${req.email}</td>
                        <td>UTR: <b>${req.utr}</b><br>‚Çπ${req.amount}</td>
                        <td>
                            <button class="btn btn-approve" onclick="approveDep('${reqSnap.key}', '${req.uid}', ${req.amount})">Approve</button>
                            <button class="btn btn-reject" onclick="rejectReq('deposits', '${reqSnap.key}')">Reject</button>
                        </td>
                    </tr>
                `;
            }
        });
    });

    // 3. Load Withdrawal Requests (Fixed Path)
    db.ref('requests/withdrawals').on('value', snap => {
        const list = document.getElementById('withdrawal-list');
        list.innerHTML = "";
        snap.forEach(reqSnap => {
            const req = reqSnap.val();
            if(req.status === "pending") {
                list.innerHTML += `
                    <tr>
                        <td>${req.email}</td>
                        <td>‚Çπ${req.amount}</td>
                        <td>
                            <button class="btn btn-approve" style="background:#3b82f6" onclick="completeWithdrawal('${reqSnap.key}')">Paid</button>
                            <button class="btn btn-reject" onclick="rejectReq('withdrawals', '${reqSnap.key}')">Reject</button>
                        </td>
                    </tr>
                `;
            }
        });
    });

    // Action Functions
    window.approveDep = (id, uid, amt) => {
        db.ref('users/' + uid + '/balance').transaction(curr => (curr || 0) + amt);
        db.ref('requests/deposits/' + id).update({ status: "approved" });
    };

    window.completeWithdrawal = (id) => {
        db.ref('requests/withdrawals/' + id).update({ status: "approved" });
        alert("Marked as Paid!");
    };

    window.rejectReq = (path, id) => {
        db.ref('requests/' + path + '/' + id).update({ status: "rejected" });
    };

</script>
</body>
</html>
