<script>
    // ... (Firebase Config pehle jaisa hi rahega) ...

    function login() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('pass').value;
        auth.signInWithEmailAndPassword(email, pass)
            .then(() => {
                document.getElementById('login-box').style.display = 'none';
                // Saare cards ko ek saath show karein
                document.getElementById('card1').style.display = 'block';
                document.getElementById('card2').style.display = 'block';
                document.getElementById('card3').style.display = 'block';
                
                // Data load call karein
                startListening(); 
            })
            .catch(err => alert("Error: " + err.message));
    }

    function startListening() {
        // 1. Fetch Users
        db.ref('users').on('value', snap => {
            let html = "";
            if (!snap.exists()) {
                html = "<tr><td colspan='3' class='status-msg'>No users found</td></tr>";
            } else {
                snap.forEach(child => {
                    let u = child.val();
                    html += `<tr>
                        <td>${u.email}</td>
                        <td style="color:#28a745; font-weight:bold;">₹${(u.balance || 0).toFixed(2)}</td>
                        <td><button class="btn btn-edit" onclick="manualEdit('${child.key}')">Edit</button></td>
                    </tr>`;
                });
            }
            document.getElementById('users-list').innerHTML = html;
        });

        // 2. Fetch Deposits (Pending Only)
        db.ref('requests/deposits').on('value', snap => {
            let html = ""; let count = 0;
            snap.forEach(child => {
                let d = child.val();
                if(d.status === 'pending') {
                    count++;
                    html += `<tr>
                        <td>${d.email}</td>
                        <td><b>₹${d.amount}</b></td>
                        <td><code>${d.utr}</code></td>
                        <td>
                            <button class="btn btn-app" onclick="approveDep('${child.key}','${d.uid}',${d.amount})">Approve</button>
                            <button class="btn btn-rej" onclick="rejectReq('deposits','${child.key}')">Reject</button>
                        </td>
                    </tr>`;
                }
            });
            document.getElementById('dep-list').innerHTML = count > 0 ? html : "<tr><td colspan='4' class='status-msg'>No pending deposits</td></tr>";
        });

        // 3. Fetch Withdrawals (Pending Only)
        db.ref('requests/withdrawals').on('value', snap => {
            let html = ""; let count = 0;
            snap.forEach(child => {
                let w = child.val();
                if(w.status === 'pending') {
                    count++;
                    html += `<tr>
                        <td>${w.email}</td>
                        <td><b>₹${w.amount}</b></td>
                        <td><small>${w.details || 'N/A'}</small></td>
                        <td>
                            <button class="btn btn-app" onclick="approveWith('${child.key}')">Mark Paid</button>
                            <button class="btn btn-rej" onclick="rejectReq('withdrawals','${child.key}')">Reject</button>
                        </td>
                    </tr>`;
                }
            });
            document.getElementById('with-list').innerHTML = count > 0 ? html : "<tr><td colspan='4' class='status-msg'>No pending withdrawals</td></tr>";
        });
    }
</script>
