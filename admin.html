<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Master Admin</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        body { background: #05080f; color: white; font-family: sans-serif; padding: 20px; }
        .card { background: #161d2b; border: 1px solid #252f44; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #252f44; }
        .btn { padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; color: white; }
        .btn-app { background: #28a745; } .btn-rej { background: #d11348; }
    </style>
</head>
<body>
    <h1>ADMIN PANEL (USERS & REQUESTS)</h1>

    <div class="card">
        <h3>USERS LIST</h3>
        <table id="u-table"><thead><tr><th>Email</th><th>Balance</th><th>Action</th></tr></thead><tbody id="u-list"></tbody></table>
    </div>

    <div class="card">
        <h3>DEPOSIT APPROVAL</h3>
        <table><thead><tr><th>User</th><th>Amount</th><th>UTR</th><th>Action</th></tr></thead><tbody id="d-list"></tbody></table>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyCrk8ksYM1Kt6ehT0TkDr3vjybjHDCyDgc", authDomain: "myaviatoregame.firebaseapp.com", projectId: "myaviatoregame", databaseURL: "https://myaviatoregame-default-rtdb.firebaseio.com", appId: "1:286687400349:web:e01e2cff439a3267de1f74" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    db.ref('users').on('value', snap => {
        let h = ""; snap.forEach(u => { h += `<tr><td>${u.val().email}</td><td>₹${u.val().balance}</td><td><button class="btn btn-app" onclick="editB('${u.key}')">Edit</button></td></tr>`; });
        document.getElementById('u-list').innerHTML = h;
    });

    db.ref('requests/deposits').on('value', snap => {
        let h = ""; snap.forEach(req => {
            let d = req.val(); if(d.status === 'pending') {
                h += `<tr><td>${d.email}</td><td>₹${d.amount}</td><td>${d.utr}</td><td>
                <button class="btn btn-app" onclick="appD('${req.key}','${d.uid}',${d.amount})">Approve</button>
                <button class="btn btn-rej" onclick="rej('deposits','${req.key}')">Reject</button></td></tr>`;
            }
        });
        document.getElementById('d-list').innerHTML = h;
    });

    function appD(key, uid, amt) {
        db.ref('users/' + uid + '/balance').transaction(c => (c || 0) + amt);
        db.ref('requests/deposits/' + key).update({ status: 'approved' });
    }
    function rej(p, k) { db.ref('requests/' + p + '/' + k).update({ status: 'rejected' }); }
    function editB(uid) { let b = prompt("New Balance?"); if(b) db.ref('users/'+uid).update({balance: parseFloat(b)}); }
</script>
</body>
</html>

