<!DOCTYPE html>
<html>
<body style="background:black; color:lime;">
    <h2>Aviator Control (SERVER RUNNING)</h2>
    <div id="log"></div>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = { ... }; // Same config
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        async function engine() {
            while(true) {
                // 1. Waiting
                for(let t=5; t>0; t--) {
                    await db.ref('gameState').set({ isFlying: false, status: 'waiting', timer: t, multiplier: 1.0 });
                    await new Promise(r => setTimeout(r, 1000));
                }
                // 2. Flying
                let m = 1.0;
                let crash = (1 + Math.pow(Math.random(), 3) * 15).toFixed(2);
                while(m < crash) {
                    await db.ref('gameState').set({ isFlying: true, status: 'flying', multiplier: m });
                    await new Promise(r => setTimeout(r, 60)); // 60ms update speed
                    m += (m < 2) ? 0.01 : 0.03;
                }
                // 3. Crash
                await db.ref('gameState').set({ isFlying: false, status: 'crashed', multiplier: m });
                await db.ref('gameHistory').push(parseFloat(m.toFixed(2)));
                await new Promise(r => setTimeout(r, 3000));
            }
        }
        engine();
    </script>
</body>
</html>
