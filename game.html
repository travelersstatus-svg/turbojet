<script>
    const firebaseConfig = { 
        apiKey: "AIzaSyCrk8ksYM1Kt6ehT0TkDr3vjybjHDCyDgc", 
        authDomain: "myaviatoregame.firebaseapp.com", 
        projectId: "myaviatoregame", 
        databaseURL: "https://myaviatoregame-default-rtdb.firebaseio.com",
        storageBucket: "myaviatoregame.firebasestorage.app", 
        messagingSenderId: "286687400349", 
        appId: "1:286687400349:web:e01e2cff439a3267de1f74" 
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    let wallet = 0, currentUser = null;
    // ... Multiplier logic same rahega (Cheats/Flying etc.) ...

    // SYNC USER DATA
    auth.onAuthStateChanged(user => {
        if (user) {
            currentUser = user;
            db.ref('users/' + user.uid + '/balance').on('value', snap => {
                wallet = snap.val() || 0;
                document.getElementById('bal-text').innerText = wallet.toFixed(2);
            });
        } else { window.location.href = "index.html"; }
    });

    // FIXED DEPOSIT REQUEST
    function requestDeposit() {
        const amt = document.getElementById('dep-amt').value;
        const utr = document.getElementById('dep-utr').value;
        if(!amt || !utr) return alert("Details bharein!");

        db.ref('requests/deposits').push({
            uid: currentUser.uid,
            email: currentUser.email,
            amount: parseFloat(amt),
            utr: utr,
            status: "pending",
            date: new Date().toLocaleString()
        }).then(() => { alert("Deposit Request Sent to Admin!"); toggleMenu(); });
    }

    // FIXED WITHDRAW REQUEST
    function requestWithdraw() {
        const amt = document.getElementById('w-amt').value;
        const details = `Acc: ${document.getElementById('w-acc').value}, IFSC: ${document.getElementById('w-ifsc').value}`;
        if(amt > wallet) return alert("Balance kam hai!");

        db.ref('requests/withdrawals').push({
            uid: currentUser.uid,
            email: currentUser.email,
            amount: parseFloat(amt),
            details: details,
            status: "pending",
            date: new Date().toLocaleString()
        }).then(() => { alert("Withdrawal Request Sent!"); toggleMenu(); });
    }

    // Handle Bet logic mein wallet update fix
    function updateWalletDB() {
        if(currentUser) db.ref('users/' + currentUser.uid).update({ balance: wallet });
    }
    // handleBet aur cashOut functions mein jahan wallet change ho raha hai, wahan updateWalletDB() call karein.
</script>
